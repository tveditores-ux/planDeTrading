<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Be Prime | Elite 10K PAS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #9b7ede; --secondary: #7fb3d5; --success: #82c91e; --danger: #e57373; 
            --bg: #1e1e24; --card: #2a2a32; --text: #d1d1d1; --water: #4fc3f7; --move: #ffb74d;
        }

        * { margin:0; padding:0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg); color: var(--text); padding: 20px; }

        .container { max-width: 1150px; margin: 0 auto; }
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 1px solid #3d3d4a; padding-bottom: 10px; }
        .tab-btn { background: none; border: none; color: #777; padding: 10px 20px; cursor: pointer; font-weight: 600; }
        .tab-btn.active { color: var(--primary); border-bottom: 2px solid var(--primary); }

        .page { display: none; animation: fadeIn 0.4s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--card); border-radius: 12px; padding: 20px; border: 1px solid #3d3d4a; margin-bottom: 20px; }
        .config-panel { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px; }
        
        .input-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 0.65rem; color: #a0a0a0; text-transform: uppercase; letter-spacing: 1px; }
        input, select { background: #1a1a1f; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 8px; outline: none; font-size: 0.9rem; }
        
        .stat-box { text-align: center; padding: 8px; border-radius: 8px; background: #23232b; border: 1px solid #333; }
        .stat-val { font-size: 1rem; font-weight: 600; }

        .main-grid { display: grid; grid-template-columns: 1fr 320px; gap: 25px; }
        .checks-container { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .check-section { background: rgba(0,0,0,0.15); padding: 12px; border-radius: 10px; border: 1px solid #333; }
        .check-section h4 { font-size: 0.65rem; color: var(--primary); margin-bottom: 10px; text-align: center; }
        .check-item { display: flex; align-items: flex-start; gap: 8px; font-size: 0.7rem; margin-bottom: 6px; color: #b0b0b0; cursor: pointer; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 8px; transition: 0.2s; }
        .btn-add { background: var(--primary); color: white; }
        .btn-sync { background: var(--success); color: #1e1e24; font-size: 0.9rem; }
        .btn-excel { background: #1d6f42; color: white; font-size: 0.85rem; border: none; }
        .btn-reminder { font-size: 0.7rem; display: flex; align-items: center; justify-content: center; gap: 8px; opacity: 0.6; }
        .btn-reminder.active { opacity: 1; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); }

        table { width: 100%; border-collapse: collapse; }
        td, th { padding: 10px; text-align: left; border-bottom: 1px solid #3d3d4a; font-size: 0.8rem; }

        #alarm-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.96); 
            display: none; justify-content: center; align-items: center; z-index: 1000; 
        }
        .modal-content { 
            background: var(--card); border: 1px solid #444; padding: 35px; 
            border-radius: 24px; text-align: center; max-width: 420px; width: 90%;
        }
        .warning-lot { color: #ff9800; font-size: 0.65rem; margin-top: 5px; font-weight: 600; }
    </style>
</head>
<body>

<div id="alarm-overlay">
    <div class="modal-content">
        <h2 id="modal-title" style="font-size: 1.2rem; margin-bottom: 5px;"></h2>
        <div id="modal-amount" style="font-size: 2.8rem; font-weight: 600; margin-bottom: 15px;"></div>
        <p id="modal-msg" style="margin-bottom: 25px; color: #a0a0a0; font-size: 0.85rem; line-height: 1.5;"></p>
        
        <button class="btn btn-sync" onclick="syncAndClose()">
            <i class="fas fa-save"></i> CARGAR AL PLAN Y APAGAR
        </button>
        
        <button class="btn btn-excel" onclick="exportToExcel()">
            <i class="fas fa-file-excel"></i> EXPORTAR BITÁCORA (CON LOTAJE)
        </button>
        
        <button onclick="document.getElementById('alarm-overlay').style.display='none'" class="btn" style="background:none; color:#555; font-size: 0.75rem;">
            Volver
        </button>
    </div>
</div>

<div class="container">
    <div class="nav-tabs">
        <button class="tab-btn active" onclick="switchTab('journal', this)">OPERATIVA PAS</button>
        <button class="tab-btn" onclick="switchTab('plan', this)">PROGRESO 21 DÍAS</button>
    </div>

    <div id="journal" class="page active">
        <div class="config-panel card">
            <div class="input-group"><label>Meta TP (%)</label>
                <input type="number" id="goal-pct" value="2" step="0.1" oninput="updateRiskParams()">
                <div class="stat-box"><div class="stat-val" id="goal-usd" style="color: var(--success)">$200.00</div></div>
            </div>
            <div class="input-group"><label>Stop Loss (%)</label>
                <input type="number" id="loss-pct" value="1" step="0.1" oninput="updateRiskParams()">
                <div class="stat-box"><div class="stat-val" id="loss-usd" style="color: var(--danger)">-$100.00</div></div>
            </div>
            <div class="input-group"><label>Capital Base</label>
                <div class="stat-box"><div class="stat-val">$10,000</div></div>
            </div>
            <div class="input-group"><label>Acumulado Hoy</label>
                <div class="stat-box" style="background: #1a1a1f;"><div class="stat-val" id="current-day-total">$0.00</div></div>
            </div>
        </div>

        <div class="main-grid">
            <div>
                <div class="card">
                    <div class="checks-container">
                        <div class="check-section">
                            <h4>ENTRADA PAS</h4>
                            <label class="check-item"><input type="checkbox" class="c-pas"> Lote 0.7 - 5.0</label>
                            <label class="check-item"><input type="checkbox" class="c-pas"> 1 Activo a la vez</label>
                            <label class="check-item"><input type="checkbox" class="c-pas"> Análisis Estructural</label>
                        </div>
                        <div class="check-section">
                            <h4>SALIDA PAS</h4>
                            <label class="check-item"><input type="checkbox" class="c-pas"> Regla del 30%</label>
                            <label class="check-item"><input type="checkbox" class="c-pas"> Máximo 5 velas</label>
                            <label class="check-item"><input type="checkbox" class="c-pas"> Cero Ansiedad</label>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <select id="asset">
                            <optgroup label="BOOM Series">
                                <option>Boom 1000</option><option>Boom 900</option><option>Boom 600</option>
                                <option>Boom 500</option><option>Boom 300</option><option>Boom 150</option>
                            </optgroup>
                            <optgroup label="CRASH Series">
                                <option>Crash 1000</option><option>Crash 900</option><option>Crash 600</option>
                                <option>Crash 500</option><option>Crash 300</option><option>Crash 150</option>
                            </optgroup>
                            <optgroup label="Volatility">
                                <option>V75</option><option>V100</option><option>V10 (1s)</option>
                            </optgroup>
                        </select>
                        <input type="number" id="trade-lot" placeholder="Lote real" step="0.01">
                        <input type="number" id="profit-val" placeholder="Resultado $">
                    </div>
                    <button class="btn btn-add" onclick="processTrade()">REGISTRAR EN BITÁCORA</button>
                </div>

                <div class="card" style="padding: 10px;">
                    <table id="history-table">
                        <thead><tr><th>HORA</th><th>ACTIVO</th><th>LOTE</th><th>MONTO</th><th></th></tr></thead>
                        <tbody id="history-body"></tbody>
                    </table>
                </div>
            </div>

            <div class="sidebar">
                <div class="card" style="height: fit-content; border-color: var(--secondary); margin-bottom: 15px;">
                    <h4 style="font-size:0.65rem; color:var(--secondary); margin-bottom:12px; text-align: center;">CALCULADORA DE RIESGO</h4>
                    <div class="input-group" style="margin-bottom:10px">
                        <label>Riesgo por trade ($)</label>
                        <input type="number" id="risk-amount" value="50" oninput="calculateLot()">
                    </div>
                    <div class="input-group" style="margin-bottom:10px">
                        <label>Puntos SL (5 velas)</label>
                        <input type="number" id="sl-points" placeholder="Ej: 10" oninput="calculateLot()">
                    </div>
                    <div class="stat-box" id="lot-box" style="border: 2px dashed var(--secondary);">
                        <label style="color: var(--secondary); font-size: 0.6rem;">LOTES SUGERIDOS:</label>
                        <div id="res-lot" style="font-size: 1.8rem; color: var(--secondary); font-weight: 600;">0.00</div>
                        <div id="lot-msg" class="warning-lot"></div>
                    </div>
                </div>

                <div class="card" style="height: fit-content; border-color: #555;">
                    <h4 style="font-size:0.65rem; color:#aaa; margin-bottom:12px; text-align: center;">RECORDATORIOS PAS</h4>
                    <button id="water-btn" class="btn btn-reminder" onclick="toggleReminder('water')">
                        <i class="fas fa-tint" style="color: var(--water)"></i> AGUA (20 MIN)
                    </button>
                    <button id="move-btn" class="btn btn-reminder" onclick="toggleReminder('move')">
                        <i class="fas fa-walking" style="color: var(--move)"></i> MOVERSE (45 MIN)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="plan" class="page">
        <div class="card">
            <h3 style="margin-bottom:20px; font-weight: 300;">PROGRESIÓN A 21 DÍAS (INTERÉS COMPUESTO)</h3>
            <div id="plan-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px;"></div>
            <div id="plan-footer" style="margin-top:20px; font-size:1rem; opacity:0.8"></div>
        </div>
    </div>
</div>

<script>
    let trades = [];
    let dailyTotal = 0;
    let completedDays = JSON.parse(localStorage.getItem('prime_days')) || [];
    let timers = { water: null, move: null };

    function switchTab(tabId, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btn.classList.add('active');
        if(tabId === 'plan') renderPlan();
    }

    function toggleReminder(type) {
        const btn = document.getElementById(type + '-btn');
        const minutes = type === 'water' ? 20 : 45;
        const msg = type === 'water' ? "PAS: Momento de beber agua e hidratar el cerebro." : "PAS: Levántate 2 minutos. Elimina el estrés visual.";

        if(timers[type]) {
            clearInterval(timers[type]);
            timers[type] = null;
            btn.classList.remove('active');
        } else {
            btn.classList.add('active');
            timers[type] = setInterval(() => {
                new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg').play();
                alert(msg);
            }, minutes * 60000);
        }
    }

    function updateRiskParams() {
        const gp = parseFloat(document.getElementById('goal-pct').value) || 0;
        const lp = parseFloat(document.getElementById('loss-pct').value) || 0;
        document.getElementById('goal-usd').innerText = `$${(10000 * (gp/100)).toFixed(2)}`;
        document.getElementById('loss-usd').innerText = `-$${(10000 * (lp/100)).toFixed(2)}`;
    }

    function calculateLot() {
        const risk = parseFloat(document.getElementById('risk-amount').value) || 0;
        const pts = parseFloat(document.getElementById('sl-points').value) || 0;
        const lot = pts > 0 ? (risk / pts) : 0;
        const resLot = document.getElementById('res-lot');
        resLot.innerText = lot.toFixed(2);
        const lotMsg = document.getElementById('lot-msg');
        
        if (lot > 0 && (lot < 0.7 || lot > 5.0)) {
            lotMsg.innerText = "⚠️ REGLA: 0.7 - 5.0";
            resLot.style.color = 'var(--danger)';
        } else {
            lotMsg.innerText = "";
            resLot.style.color = 'var(--secondary)';
        }
    }

    function processTrade() {
        const val = parseFloat(document.getElementById('profit-val').value);
        const lot = parseFloat(document.getElementById('trade-lot').value) || 0;
        if(isNaN(val)) return;
        if(document.querySelectorAll('.c-pas:checked').length < 6) {
            alert("⚠️ Requisito PAS: Marca todos los puntos del checklist."); return;
        }

        const now = new Date();
        trades.push({ 
            id: Date.now(),
            fecha: now.toLocaleDateString(),
            hora: now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}), 
            activo: document.getElementById('asset').value,
            lotaje: lot,
            monto: val 
        });
        
        renderHistory();
        checkThresholds();
        document.getElementById('profit-val').value = "";
        document.getElementById('trade-lot').value = "";
        document.querySelectorAll('.c-pas').forEach(c => c.checked = false);
    }

    function renderHistory() {
        const body = document.getElementById('history-body');
        body.innerHTML = ""; dailyTotal = 0;
        trades.forEach(t => {
            dailyTotal += t.monto;
            const row = body.insertRow(0);
            row.innerHTML = `<td>${t.hora}</td><td>${t.activo}</td><td>${t.lotaje}</td><td style="color:${t.monto>=0?'var(--success)':'var(--danger)'}">${t.monto.toFixed(2)}</td><td><button style="color:var(--danger); background:none; border:none; cursor:pointer" onclick="deleteTrade(${t.id})">×</button></td>`;
        });
        document.getElementById('current-day-total').innerText = `$${dailyTotal.toFixed(2)}`;
    }

    function deleteTrade(id) {
        trades = trades.filter(t => t.id !== id);
        renderHistory();
    }

    function checkThresholds() {
        const win = 10000 * (parseFloat(document.getElementById('goal-pct').value)/100);
        const loss = -(10000 * (parseFloat(document.getElementById('loss-pct').value)/100));

        if(dailyTotal >= win) showModal("SESIÓN COMPLETADA", dailyTotal, "Meta alcanzada. Exporta tus resultados y desconéctate.", 'var(--success)');
        else if(dailyTotal <= loss) showModal("LÍMITE DE RIESGO", dailyTotal, "Stop Loss respetado. Mañana el mercado seguirá ahí.", 'var(--danger)');
    }

    function showModal(title, amount, msg, color) {
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-title').style.color = color;
        document.getElementById('modal-amount').innerText = `$${amount.toFixed(2)}`;
        document.getElementById('modal-amount').style.color = color;
        document.getElementById('modal-msg').innerText = msg;
        document.getElementById('alarm-overlay').style.display = 'flex';
    }

    function syncAndClose() {
        completedDays.push(dailyTotal);
        localStorage.setItem('prime_days', JSON.stringify(completedDays));
        trades = []; dailyTotal = 0; renderHistory();
        document.getElementById('alarm-overlay').style.display = 'none';
        switchTab('plan', document.querySelectorAll('.tab-btn')[1]);
    }

    function renderPlan() {
        const container = document.getElementById('plan-container');
        container.innerHTML = "";
        let cap = 10000;
        const pct = (parseFloat(document.getElementById('goal-pct').value) || 2) / 100;

        for(let i=1; i<=21; i++) {
            let isDone = completedDays[i-1] !== undefined;
            let pft = isDone ? completedDays[i-1] : (cap * pct);
            container.innerHTML += `<div class="day-box ${isDone?'completed':''}" style="padding:12px; border:1px solid #444; border-radius:10px; text-align:center; background:${isDone?'rgba(130,201,30,0.1)':'transparent'}">
                <span style="font-size:0.55rem; color:#777">D${i}</span><br>
                <b style="${isDone?'color:var(--success)':''}">$${pft.toFixed(0)}</b><br>
                <span style="font-size:0.55rem; opacity:0.5">$${cap.toLocaleString()}</span>
            </div>`;
            cap += pft;
        }
        document.getElementById('plan-footer').innerText = `Proyección Final: $${cap.toLocaleString()}`;
    }

    function exportToExcel() {
        if(trades.length === 0) return alert("Sin datos.");
        const wsData = trades.map(t => ({
            Fecha: t.fecha, Hora: t.hora, Activo: t.activo, Lotaje: t.lotaje, Monto: t.monto
        }));
        const ws = XLSX.utils.json_to_sheet(wsData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Bitacora");
        XLSX.writeFile(wb, `Trade_Elite_10K_${new Date().toISOString().slice(0,10)}.xlsx`);
    }

    updateRiskParams();
    calculateLot();
</script>
</body>
</html>
